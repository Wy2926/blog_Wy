(function(n){"use strict";Date.now=Date.now||function(){return+new Date};n.ias=function(t){function w(){var t,c;s.onChangePage(function(n,t,r){u&&u.setPage(n,r);i.onPageChange.call(this,n,r,t)});return i.triggerPageThreshold>0?f():n(i.next).attr("href")&&(c=o.getCurrentScrollOffset(i.scrollContainer),p(function(){e(c)})),u&&u.havePage()&&(r(),t=u.getPage(),o.forceScrollTop(function(){var i;t>1?(a(t),i=h(!0),n("html, body").scrollTop(i)):f()})),tt}function f(){l();i.scrollContainer.scroll(c)}function c(){var n,t;n=o.getCurrentScrollOffset(i.scrollContainer);t=h();n>=t&&(k()>=i.triggerPageThreshold?(r(),p(function(){e(n)})):e(n))}function r(){i.scrollContainer.unbind("scroll",c)}function l(){n(i.pagination).hide()}function h(t){var r,u;return r=n(i.container).find(i.item).last(),r.size()===0?0:(u=r.offset().top+r.height(),t||(u+=i.thresholdMargin),u)}function e(t,u){var e;if(e=n(i.next).attr("href"),!e)return i.noneleft&&n(i.container).find(i.item).last().after(i.noneleft),r();i.beforePageChange&&n.isFunction(i.beforePageChange)&&i.beforePageChange(t,e)===!1||(s.pushPages(t,e),r(),d(),b(e,function(t,o){var h=i.onLoadItems.call(this,o),s;h!==!1&&(n(o).hide(),s=n(i.container).find(i.item).last(),s.after(o),n(o).fadeIn());e=n(i.next,t).attr("href");n(i.pagination).replaceWith(n(i.pagination,t));g();l();e?f():r();i.onRenderComplete.call(this,o);u&&u.call(this)}))}function b(t,r,u){var e=[],f,h=Date.now(),o,s;u=u||i.loaderDelay;n.get(t,null,function(t){f=n(i.container,t).eq(0);0===f.length&&(f=n(t).filter(i.container).eq(0));f&&f.find(i.item).each(function(){e.push(this)});r&&(s=this,o=Date.now()-h,o<u?setTimeout(function(){r.call(s,t,e)},u-o):r.call(s,t,e))},"html")}function a(t){var i=h(!0);i>0&&e(i,function(){r();s.getCurPageNum(i)+1<t?(a(t),n("html,body").animate({scrollTop:i},400,"swing")):(n("html,body").animate({scrollTop:i},1e3,"swing"),f())})}function k(){var n=o.getCurrentScrollOffset(i.scrollContainer);return s.getCurPageNum(n)}function v(){var t=n(".ias_loader");return t.size()===0&&(t=n('<div class="ias_loader">'+i.loader+"<\/div>"),t.hide()),t}function d(){var t=v(),r;i.customLoaderProc!==!1?i.customLoaderProc(t):(r=n(i.container).find(i.item).last(),r.after(t),t.fadeIn())}function g(){var n=v();n.remove()}function y(t){var r=n(".ias_trigger");return r.size()===0&&(r=n('<div class="ias_trigger"><a href="javascript:;">'+i.trigger+"<\/a><\/div>"),r.hide()),n("a",r).unbind("click").bind("click",function(){return nt(),t.call(),!1}),r}function p(t){var r=y(t),u;i.customTriggerProc!==!1?i.customTriggerProc(r):(u=n(i.container).find(i.item).last(),u.after(r),r.fadeIn())}function nt(){var n=y();n.remove()}var i=n.extend({},n.ias.defaults,t),o=new n.ias.util,s=new n.ias.paging(i.scrollContainer),u=i.history?new n.ias.history:!1,tt=this;w()};n.ias.defaults={container:"#container",scrollContainer:n(window),item:".item",pagination:"#pagination",next:".next",noneleft:!1,loader:'<img src="images/loader.gif"/>',loaderDelay:600,triggerPageThreshold:3,trigger:"Load more items",thresholdMargin:0,history:!0,onPageChange:function(){},beforePageChange:function(){},onLoadItems:function(){},onRenderComplete:function(){},customLoaderProc:!1,customTriggerProc:!1};n.ias.util=function(){function r(){n(window).load(function(){t=!0})}var t=!1,i=!1,u=this;r();this.forceScrollTop=function(r){n("html,body").scrollTop(0);i||(t?(r.call(),i=!0):setTimeout(function(){u.forceScrollTop(r)},1))};this.getCurrentScrollOffset=function(n){var t,i;return t=n.get(0)===window?n.scrollTop():n.offset().top,i=n.height(),t+i}};n.ias.paging=function(){function e(){n(window).scroll(o)}function o(){var e,t,o,h,c;e=f.getCurrentScrollOffset(n(window));t=i(e);o=s(e);u!==t&&(h=o[0],c=o[1],r.call({},t,h,c));u=t}function i(n){for(var i=t.length-1;i>0;i--)if(n>t[i][0])return i+1;return 1}function s(n){for(var i=t.length-1;i>=0;i--)if(n>t[i][0])return t[i];return null}var t=[[0,document.location.toString()]],r=function(){},u=1,f=new n.ias.util;e();this.getCurPageNum=function(t){return t=t||f.getCurrentScrollOffset(n(window)),i(t)};this.onChangePage=function(n){r=n};this.pushPages=function(n,i){t.push([n,i])}};n.ias.history=function(){function i(){n=!!(window.history&&history.pushState&&history.replaceState);n=!1}var t=!1,n=!1;i();this.setPage=function(n,t){this.updateState({page:n},"",t)};this.havePage=function(){return this.getState()!==!1};this.getPage=function(){var n;return this.havePage()?(n=this.getState(),n.page):1};this.getState=function(){var i,t,r;if(n){if(t=history.state,t&&t.ias)return t.ias}else if(i=window.location.hash.substring(0,7)==="#/page/",i)return r=parseInt(window.location.hash.replace("#/page/",""),10),{page:r};return!1};this.updateState=function(n,i,r){t?this.replaceState(n,i,r):this.pushState(n,i,r)};this.pushState=function(i,r,u){var f;n?history.pushState({ias:i},r,u):(f=i.page>0?"#/page/"+i.page:"",window.location.hash=f);t=!0};this.replaceState=function(t,i,r){n?history.replaceState({ias:t},i,r):this.pushState(t,i,r)}}})(jQuery);